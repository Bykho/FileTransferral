import { Inject, Injectable, InjectionToken } from '@angular/core';
import * as i0 from "@angular/core";
export var StorageType;
(function (StorageType) {
    StorageType[StorageType["localStorage"] = 0] = "localStorage";
    StorageType[StorageType["sessionStorage"] = 1] = "sessionStorage";
})(StorageType || (StorageType = {}));
export const AUTH_CONFIG = new InjectionToken('auth-config', { providedIn: 'root', factory: AUTH_CONFIG_FACTORY });
export function AUTH_CONFIG_FACTORY() {
    return new AuthConfig();
}
export class AuthConfig {
    constructor() {
        this.storageType = StorageType.localStorage;
        this.storageName = 'oauthToken';
    }
}
export class AuthConfigService {
    constructor(config) {
        this.config = config;
        this.defaultConfig = {
            storageType: StorageType.localStorage,
            storageName: 'oauthToken',
            baseUrl: '',
            clientId: 'VBL.Manage.End',
            scope: 'openid profile default-api',
            redirectUri: window.top.location.origin,
            profileUri: 'userinfo',
            logoutPath: '/',
            notAuthUrl: 'login,manage/user/mobile/',
            tokenType: 'token_type',
            accessToken: 'access_token',
            upperTokenType: true,
        };
        this.authConfig = { ...this.defaultConfig, ...this.config };
    }
    getStorage() {
        let storage;
        if (this.authConfig.storageType === StorageType.localStorage) {
            storage = localStorage;
        }
        else {
            storage = sessionStorage;
        }
        return storage;
    }
    getToken() {
        const dataString = this.getStorage()[this.authConfig.storageName];
        if (dataString) {
            const data = JSON.parse(dataString);
            if (data && data.expires_at && new Date(data.expires_at) >= new Date()) {
                return data;
            }
        }
        return null;
    }
    getAuthorizationHeader() {
        const token = this.getToken();
        if (token) {
            const tokenType = token.token_type;
            const accessToken = token.access_token;
            return `${this.config.upperTokenType ? tokenType[0].toUpperCase() : tokenType[0] + tokenType.substr(1)} ${accessToken}`;
        }
        return '';
    }
    setToken(data) {
        this.getStorage()[this.authConfig.storageName] = JSON.stringify(data);
    }
    removeToken() {
        delete this.getStorage()[this.authConfig.storageName];
    }
    login(tokenStr, remember = true) {
        const token = {};
        token[this.authConfig.tokenType] = 'bearer';
        token[this.authConfig.accessToken] = tokenStr;
        if (!remember) {
            this.authConfig.storageType = StorageType.sessionStorage;
        }
        else {
            const date = new Date();
            this.authConfig.storageType = StorageType.localStorage;
            token.expires_at = date.setDate(date.getDate() + 7);
        }
        this.setToken(token);
    }
    logout() {
        sessionStorage.clear();
        this.removeToken();
        window.top.location.href = `${this.authConfig.logoutPath}`;
    }
}
AuthConfigService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.0.1", ngImport: i0, type: AuthConfigService, deps: [{ token: AUTH_CONFIG }], target: i0.ɵɵFactoryTarget.Injectable });
AuthConfigService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "15.0.1", ngImport: i0, type: AuthConfigService, providedIn: 'root' });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.0.1", ngImport: i0, type: AuthConfigService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root'
                }]
        }], ctorParameters: function () { return [{ type: AuthConfig, decorators: [{
                    type: Inject,
                    args: [AUTH_CONFIG]
                }] }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0aC1jb25maWcuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2FhaS9zcmMvbGliL2NvcmUvYXV0aC1jb25maWcuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxjQUFjLEVBQUUsTUFBTSxlQUFlLENBQUM7O0FBRW5FLE1BQU0sQ0FBTixJQUFZLFdBR1g7QUFIRCxXQUFZLFdBQVc7SUFDbkIsNkRBQWdCLENBQUE7SUFDaEIsaUVBQWtCLENBQUE7QUFDdEIsQ0FBQyxFQUhXLFdBQVcsS0FBWCxXQUFXLFFBR3RCO0FBRUQsTUFBTSxDQUFDLE1BQU0sV0FBVyxHQUFHLElBQUksY0FBYyxDQUFDLGFBQWEsRUFBRSxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLG1CQUFtQixFQUFDLENBQUMsQ0FBQztBQUNsSCxNQUFNLFVBQVUsbUJBQW1CO0lBQy9CLE9BQU8sSUFBSSxVQUFVLEVBQUUsQ0FBQztBQUM1QixDQUFDO0FBQ0QsTUFBTSxPQUFPLFVBQVU7SUFBdkI7UUFDVyxnQkFBVyxHQUFnQixXQUFXLENBQUMsWUFBWSxDQUFDO1FBQ3BELGdCQUFXLEdBQUcsWUFBWSxDQUFDO0lBV3RDLENBQUM7Q0FBQTtBQUtELE1BQU0sT0FBTyxpQkFBaUI7SUFnQjFCLFlBQXlDLE1BQWtCO1FBQWxCLFdBQU0sR0FBTixNQUFNLENBQVk7UUFmM0Qsa0JBQWEsR0FBZTtZQUN4QixXQUFXLEVBQUUsV0FBVyxDQUFDLFlBQVk7WUFDckMsV0FBVyxFQUFFLFlBQVk7WUFDekIsT0FBTyxFQUFFLEVBQUU7WUFDWCxRQUFRLEVBQUUsZ0JBQWdCO1lBQzFCLEtBQUssRUFBRSw0QkFBNEI7WUFDbkMsV0FBVyxFQUFFLE1BQU0sQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLE1BQU07WUFDdkMsVUFBVSxFQUFFLFVBQVU7WUFDdEIs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UUFDRCxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3pCLENBQUM7SUFFRCxNQUFNO1FBQ0YsY0FBYyxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNuQixNQUFNLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxJQUFJLEdBQUcsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLFVBQVUsRUFBRSxDQUFDO0lBQy9ELENBQUM7OzhHQTdFUSxpQkFBaUIsa0JBZ0JOLFdBQVc7a0hBaEJ0QixpQkFBaUIsY0FGZCxNQUFNOzJGQUVULGlCQUFpQjtrQkFIN0IsVUFBVTttQkFBQztvQkFDUixVQUFVLEVBQUUsTUFBTTtpQkFDckI7OzBCQWlCZ0IsTUFBTTsyQkFBQyxXQUFXIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0LCBJbmplY3RhYmxlLCBJbmplY3Rpb25Ub2tlbiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5leHBvcnQgZW51bSBTdG9yYWdlVHlwZSB7XG4gICAgbG9jYWxTdG9yYWdlID0gMCxcbiAgICBzZXNzaW9uU3RvcmFnZSA9IDFcbn1cblxuZXhwb3J0IGNvbnN0IEFVVEhfQ09ORklHID0gbmV3IEluamVjdGlvblRva2VuKCdhdXRoLWNvbmZpZycsIHsgcHJvdmlkZWRJbjogJ3Jvb3QnLCBmYWN0b3J5OiBBVVRIX0NPTkZJR19GQUNUT1JZfSk7XG5leHBvcnQgZnVuY3Rpb24gQVVUSF9DT05GSUdfRkFDVE9SWSgpOiBBdXRoQ29uZmlnIHtcbiAgICByZXR1cm4gbmV3IEF1dGhDb25maWcoKTtcbn1cbmV4cG9ydCBjbGFzcyBBdXRoQ29uZmlnIHtcbiAgICBwdWJsaWMgc3RvcmFnZVR5cGU6IFN0b3JhZ2VUeXBlID0gU3RvcmFnZVR5cGUubG9jYWxTdG9yYWdlO1xuICAgIHB1YmxpYyBzdG9yYWdlTmFtZSA9ICdvYXV0aFRva2VuJztcbiAgICBwdWJsaWMgYmFzZVVybDogc3RyaW5nO1xuICAgIHB1YmxpYyBjbGllbnRJZDogc3RyaW5nO1xuICAgIHB1YmxpYyBzY29wZTogc3RyaW5nO1xuICAgIHB1YmxpYyByZWRpcmVjdFVyaTogc3RyaW5nO1xuICAgIHB1YmxpYyBwcm9maWxlVXJpOiBzdHJpbmc7XG4gICAgcHVibGljIGxvZ291dFBhdGg6IHN0cmluZztcbiAgICBwdWJsaWMgbm90QXV0aFVybDogc3RyaW5nO1xuICAgIHB1YmxpYyB0b2tlblR5cGU6IHN0cmluZztcbiAgICBwdWJsaWMgYWNjZXNzVG9rZW46IHN0cmluZztcbiAgICBwdWJsaWMgdXBwZXJUb2tlblR5cGU6IGJvb2xlYW47XG59XG5cbkBJbmplY3RhYmxlKHtcbiAgICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5leHBvcnQgY2xhc3MgQXV0aENvbmZpZ1NlcnZpY2Uge1xuICAgIGRlZmF1bHRDb25maWc6IEF1dGhDb25maWcgPSB7XG4gICAgICAgIHN0b3JhZ2VUeXBlOiBTdG9yYWdlVHlwZS5sb2NhbFN0b3JhZ2UsXG4gICAgICAgIHN0b3JhZ2VOYW1lOiAnb2F1dGhUb2tlbicsXG4gICAgICAgIGJhc2VVcmw6ICcnLFxuICAgICAgICBjbGllbnRJZDogJ1ZCTC5NYW5hZ2UuRW5kJyxcbiAgICAgICAgc2NvcGU6ICdvcGVuaWQgcHJvZmlsZSBkZWZhdWx0LWFwaScsXG4gICAgICAgIHJlZGlyZWN0VXJpOiB3aW5kb3cudG9wLmxvY2F0aW9uLm9yaWdpbixcbiAgICAgICAgcHJvZmlsZVVyaTogJ3VzZXJpbmZvJyxcbiAgICAgICAgbG9nb3V0UGF0aDogJy8nLFxuICAgICAgICBub3RBdXRoVXJsOiAnbG9naW4sbWFuYWdlL3VzZXIvbW9iaWxlLycsXG4gICAgICAgIHRva2VuVHlwZTogJ3Rva2VuX3R5cGUnLFxuICAgICAgICBhY2Nlc3NUb2tlbjogJ2FjY2Vzc190b2tlbicsXG4gICAgICAgIHVwcGVyVG9rZW5UeXBlOiB0cnVlLFxuICAgIH07XG4gICAgYXV0aENvbmZpZzogQXV0aENvbmZpZztcbiAgICBjb25zdHJ1Y3RvcihASW5qZWN0KEFVVEhfQ09ORklHKSBwcml2YXRlIGNvbmZpZzogQXV0aENvbmZpZykge1xuICAgICAgICB0aGlzLmF1dGhDb25maWcgPSB7IC4uLnRoaXMuZGVmYXVsdENvbmZpZywgLi4udGhpcy5jb25maWd9O1xuICAgIH1cblxuICAgIGdldFN0b3JhZ2UoKSB7XG4gICAgICAgIGxldCBzdG9yYWdlOiBTdG9yYWdlO1xuICAgICAgICBpZiAodGhpcy5hdXRoQ29uZmlnLnN0b3JhZ2VUeXBlID09PSBTdG9yYWdlVHlwZS5sb2NhbFN0b3JhZ2UpIHtcbiAgICAgICAgICAgIHN0b3JhZ2UgPSBsb2NhbFN0b3JhZ2U7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzdG9yYWdlID0gc2Vzc2lvblN0b3JhZ2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHN0b3JhZ2U7XG4gICAgfVxuXG4gICAgZ2V0VG9rZW4oKTogYW55IHtcbiAgICAgICAgY29uc3QgZGF0YVN0cmluZyA9IHRoaXMuZ2V0U3RvcmFnZSgpW3RoaXMuYXV0aENvbmZpZy5zdG9yYWdlTmFtZV07XG4gICAgICAgIGlmIChkYXRhU3RyaW5nKSB7XG4gICAgICAgICAgICBjb25zdCBkYXRhID0gSlNPTi5wYXJzZShkYXRhU3RyaW5nKTtcbiAgICAgICAgICAgIGlmIChkYXRhICYmIGRhdGEuZXhwaXJlc19hdCAmJiBuZXcgRGF0ZShkYXRhLmV4cGlyZXNfYXQpID49IG5ldyBEYXRlKCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBnZXRBdXRob3JpemF0aW9uSGVhZGVyKCk6IHN0cmluZyB7XG4gICAgICAgIGNvbnN0IHRva2VuID0gdGhpcy5nZXRUb2tlbigpO1xuICAgICAgICBpZiAodG9rZW4pIHtcbiAgICAgICAgICAgIGNvbnN0IHRva2VuVHlwZSA9IHRva2VuLnRva2VuX3R5cGU7XG4gICAgICAgICAgICBjb25zdCBhY2Nlc3NUb2tlbiA9IHRva2VuLmFjY2Vzc190b2tlbjtcbiAgICAgICAgICAgIHJldHVybiBgJHt0aGlzLmNvbmZpZy51cHBlclRva2VuVHlwZSA/IHRva2VuVHlwZVswXS50b1VwcGVyQ2FzZSgpIDogdG9rZW5UeXBlWzBdICsgdG9rZW5UeXBlLnN1YnN0cigxKX0gJHthY2Nlc3NUb2tlbn1gO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAnJztcbiAgICB9XG5cbiAgICBzZXRUb2tlbihkYXRhOiBhbnkpIHtcbiAgICAgICAgdGhpcy5nZXRTdG9yYWdlKClbdGhpcy5hdXRoQ29uZmlnLnN0b3JhZ2VOYW1lXSA9IEpTT04uc3RyaW5naWZ5KGRhdGEpO1xuICAgIH1cblxuICAgIHJlbW92ZVRva2VuKCkge1xuICAgICAgICBkZWxldGUgdGhpcy5nZXRTdG9yYWdlKClbdGhpcy5hdXRoQ29uZmlnLnN0b3JhZ2VOYW1lXTtcbiAgICB9XG5cbiAgICBsb2dpbih0b2tlblN0ciwgcmVtZW1iZXIgPSB0cnVlKSB7XG4gICAgICAgIGNvbnN0IHRva2VuOiBhbnkgPSB7fTtcbiAgICAgICAgdG9rZW5bdGhpcy5hdXRoQ29uZmlnLnRva2VuVHlwZV0gPSAnYmVhcmVyJztcbiAgICAgICAgdG9rZW5bdGhpcy5hdXRoQ29uZmlnLmFjY2Vzc1Rva2VuXSA9IHRva2VuU3RyO1xuICAgICAgICBpZiAoIXJlbWVtYmVyKSB7XG4gICAgICAgICAgICB0aGlzLmF1dGhDb25maWcuc3RvcmFnZVR5cGUgPSBTdG9yYWdlVHlwZS5zZXNzaW9uU3RvcmFnZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAgICAgdGhpcy5hdXRoQ29uZmlnLnN0b3JhZ2VUeXBlID0gU3RvcmFnZVR5cGUubG9jYWxTdG9yYWdlO1xuICAgICAgICAgICAgdG9rZW4uZXhwaXJlc19hdCA9IGRhdGUuc2V0RGF0ZShkYXRlLmdldERhdGUoKSArIDcpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0VG9rZW4odG9rZW4pO1xuICAgIH1cblxuICAgIGxvZ291dCgpIHtcbiAgICAgICAgc2Vzc2lvblN0b3JhZ2UuY2xlYXIoKTtcbiAgICAgICAgdGhpcy5yZW1vdmVUb2tlbigpO1xuICAgICAgICB3aW5kb3cudG9wLmxvY2F0aW9uLmhyZWYgPSBgJHt0aGlzLmF1dGhDb25maWcubG9nb3V0UGF0aH1gO1xuICAgIH1cblxufVxuIl19